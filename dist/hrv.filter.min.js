!function(n,e){var a="filter";function r(e,t){this.element=n(e),this.options=n.extend({},n.fn[a].defaults,this.element.data(),t),this.sections=this.element.find("[filter-sections]"),this.selected=this.element.find("[filter-selected]"),this.sortby=this.element.find("[filter-sortby]"),this.container=this.element.find("[filter-container]"),this.btnLoadMore=this.element.find("[filter-btnload]"),this.cur_page=parseInt(this.element.data("currentPage"),10)||1,this.total_page=parseInt(this.element.data("pageSize"),10)||0,this.id=this.element.data("id"),this.handle=this.element.data("handle"),this.viewData=this.element.data("view"),this.viewPagesize=this.element.data("viewPageSize"),this.query="",this.handle&&"all"!==this.handle?this.query="/search?q=filter=((collectionid:product="+this.id+")":this.query="/search?q=filter=((collectionid:product>=0)",this.init()}r.prototype={init:function(){var t=this;this.options;t.btnLoadMore.on("click",function(){t.loadmore()}),t.sortby.on("change",function(){t.triggerFilter()}),t.sections.find("[filter-option]").on("change",function(){var e=n(this).parents("[filter-sections]");if(e.data("single")){n(this).is(":checked");e.find("[filter-option]").prop("checked",!1),n(this).prop("checked",!0)}t.triggerFilter()}),t.selected.on("click",".filter-selected-remove",function(){var e=n(this).data("id");n("#"+e).prop("checked",!1).trigger("change")}),t.selected.on("click",".filter-selected-clear",function(){t.sections.find("[filter-option]").prop("checked",!1),t.triggerFilter()}),t.element.on("click","[filter-pagination]",function(e){e.preventDefault(),t.getProduct(n(this).data("page")||0)})},renderSelected:function(){var i=[],e="",t="";this.sections.each(function(){var e=n(this).find("[filter-option]");n.each(e,function(e,t){n(t).is(":checked")&&i.push({label:n(t).data("label"),id:n(t).data("id")})})}),i.forEach(function(e){t+="<div class='filter-selected-item'>"+e.label+" <span class='filter-selected-remove' data-id='"+e.id+"' >X</span> </div>"}),""!==t&&(e=t+'<button class="filter-selected-clear"> há»§y </button>'),this.selected.html(e)},genQuery:function(){var t=[],i="";return this.sections.each(function(){var i="",e=n(this).find("[filter-option]");n.each(e,function(e,t){n(t).is(":checked")&&(i+=n(t).val()+"||")}),t.push(i)}),t.forEach(function(e){e&&(e=(e+="#").replace("||#",""),i+="&&("+e+")")}),this.query+i+")"},getProduct:function(e){var t=this,i=t.genQuery()+"&view="+t.viewData+"&sortby="+t.sortby.val()+"&page="+e;n.ajax({url:i,method:"get",success:function(e){t.container.html(e)},error:function(e){console.error("getProduct",e)}})},getPageSize:function(){var t=this,e=t.genQuery()+"&view="+t.viewPagesize;n.ajax({url:e,method:"get",success:function(e){t.element.data("pageSize",parseInt(e,10)),t.element.data("currentPage",1)},error:function(e){console.error("getPageSize",e)}})},triggerFilter:function(){var e=this;e.btnLoadMore.removeClass("hidden"),e.getPageSize(),e.getProduct(0),e.renderSelected()},loadmore:function(){var t=this;if(t.total_page>t.cur_page){t.cur_page++;var e=t.genQuery()+"&view="+t.viewData+"&sortby="+t.sortby.val()+"&page="+t.cur_page;n.ajax({url:e,method:"get",success:function(e){t.container.append(e),t.total_page==t.cur_page?t.btnLoadMore.addClass("hidden"):t.btnLoadMore.removeClass("hidden")}})}else t.btnLoadMore.addClass("hidden")},destroy:function(){n.removeData(this.element[0],a)}},n.fn[a]=function(t,i){return this.each(function(){var e=n.data(this,a);e?e[t]&&e[t](i):n.data(this,a,new r(this,t))})},n.fn[a].defaults={},n(function(){n("[data-"+a+"]")[a]()})}(jQuery,window);